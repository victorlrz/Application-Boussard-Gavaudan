<div class="container">
    <div class="row">
      <h1 class="mt-3">Stocks</h1>
      <% if current_user.admin %>
        <%= link_to "Create a new stock", new_stock_path, class: "btn btn-primary btn-block mt-3 mb-3 mr-5 ml-5", style:"width: 200px" %>
      <% end %>
    </div>
</div>


<div class="container">
  <table id="datatables-reponsive" class="table table-striped" style="width:100%">
    <thead>
      <tr>
        <th scope="col" class="text-center align-middle">Name</th>
        <th scope="col" class="text-center align-middle">Identifier</th>
        <th scope="col" class="text-center align-middle">Price</th>
        <th scope="col" class="text-center align-middle">Mkt Cap</th>
        <th scope="col" class="text-center align-middle">Revenue TTM</th>
        <th scope="col" class="text-center align-middle">P/E TTM</th>
        <th scope="col" class="text-center align-middle">1D - Chg</th>
        <th scope="col" class="text-center align-middle">1Y - Chg</th>
        <th scope="col" class="text-center align-middle">Beta</th>
        <th scope="col" class="text-center align-middle">Comment</th>
        <th scope="col" class="text-center align-middle"> BG LTV - BGEQT (<%= Portfolio.last.date.strftime("%d/%m/%y") %>) weight (%)</th>
      </tr>
    </thead>
    <tbody>
      <% @stocks.order("beta_ft DESC").each do |stock| %>
        <tr>
          <td class="align-middle" style="width: 200px;"><%= link_to stock.name, stock_path(stock)  %></td>
          <td class="text-center align-middle"><%= stock.identifier %></td>
          <td class="text-center align-middle"><%= stock.price %></td>
          <td class="text-center align-middle"><%= stock.ebitda.split("Market cap")[1].split("EPS")[0] unless stock.ebitda.split("Market cap")[1].nil? %></td>
          <td class="text-center align-middle"><%= stock.revenue.split("Revenue in ").pop.split("Net income ").first.sub('(TTM)', '').split(" ").last unless stock.revenue.nil?  %></td>
          <td class="text-center align-middle"><%= stock.ebitda.split("P/E (TTM)").last.split("Market cap").first unless stock.ebitda.nil?%></td>

          <% if  stock.price_1chg.split(" / ").last.to_f > 0%>
              <td class="text-center align-middle text-success"><%= stock.price_1chg.split(" / ").last unless stock.price_1chg.nil? %></td>
            <% else %>
              <td class="text-center align-middle text-danger"><%= stock.price_1chg.split(" / ").last unless stock.price_1chg.nil? %></td>
          <% end %>
          <% if stock.price_yrchg.to_f > 0 %>
            <td class="text-center align-middle text-success"><%= stock.price_yrchg %></td>
          <% else %>
              <td class="text-center align-middle text-danger"><%= stock.price_yrchg %></td>
          <% end %>
          <td class="text-center align-middle"><%= stock.beta_ft %></td>
          <td class="text-center align-middle"><%= stock.comments.count %></td>
          <td class="text-center align-middle"><% recherche = Stock.find_by(name: stock.name).id %> <%= Portfolio.find_by(stock_id: recherche).weight unless Portfolio.find_by(stock_id: recherche).nil? %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
